<?xml version="1.0"?>
<document type="freeswitch/xml">

  <X-PRE-PROCESS cmd="set" data="local_ip_v4=192.168.1.3"/>
  <X-PRE-PROCESS cmd="set" data="test_provier_ip=192.168.1.7"/>
  <X-PRE-PROCESS cmd="set" data="test_provier_port=40000"/>
  
  <X-PRE-PROCESS cmd="set" data="sound_prefix=$${sounds_dir}/en/us/callie"/>

  <section name="configuration">

    <configuration name="switch.conf">
      <cli-keybindings>
        <key name="6" value="reloadxml"/>
        <key name="7" value="console loglevel 0"/>
        <key name="8" value="console loglevel 7"/>
      </cli-keybindings>
      <settings>
        <param name="colorize-console" value="true"/>
        <param name="max-sessions" value="1000"/>
        <param name="sessions-per-second" value="30"/>
        <param name="loglevel" value="debug"/>
      </settings>
    </configuration>

    <configuration name="modules.conf">
      <modules>
        <load module="mod_console"/>
        <load module="mod_logfile"/>
        <load module="mod_event_socket"/>
        <load module="mod_sofia"/>
        <load module="mod_dialplan_xml"/>
        <load module="mod_dptools"/>
        <load module="mod_commands"/>
        <load module="mod_expr"/>
        <load module="mod_sndfile"/>
        <load module="mod_voicemail"/>
      </modules>
    </configuration>

    <configuration name="console.conf">
      <mappings>
        <map name="all" value="console,debug,info,notice,warning,err,crit,alert"/>
      </mappings>
      <settings>
        <param name="colorize" value="true"/>
        <param name="loglevel" value="info"/>
      </settings>
    </configuration>

    <configuration name="logfile.conf">
      <settings>
        <param name="rotate-on-hup" value="true"/>
      </settings>
      <profiles>
        <profile name="default">
          <settings>
            <param name="logfile" value="$${base_dir}/log/freeswitch.log"/>
            <param name="rollover" value="10485760"/>
          </settings>
          <mappings>
            <map name="all" value="debug,info,notice,warning,err,crit,alert"/>
          </mappings>
        </profile>
      </profiles>
    </configuration>

    <configuration name="event_socket.conf">
      <settings>
        <param name="listen-ip" value="127.0.0.1"/>
        <param name="listen-port" value="8021"/>
        <param name="password" value="ClueCon"/>
      </settings>
    </configuration>

    <configuration name="sofia.conf">
      <global_settings>
        <param name="log-level" value="0"/>
        <param name="debug-presence" value="0"/>
      </global_settings>
      <profiles>
        <profile name="sbc">
          <domains>
            <domain name="all" alias="true" parse="false"/>
          </domains>
          <settings>
            <param name="context" value="default"/>
            <param name="sip-port" value="6060"/>
            <param name="dialplan" value="XML"/>
            <param name="rtp-ip" value="$${local_ip_v4}"/>
            <param name="sip-ip" value="$${local_ip_v4}"/>
            <param name="auth-calls" value="true"/>
          </settings>
        </profile>
        <profile name="internal">
          <domains>
            <domain name="all" alias="true" parse="false"/>
          </domains>
          <settings>
            <param name="context" value="default"/>
            <param name="sip-port" value="5060"/>
            <param name="dialplan" value="XML"/>
            <param name="rtp-ip" value="$${local_ip_v4}"/>
            <param name="sip-ip" value="$${local_ip_v4}"/>
            <param name="auth-calls" value="true"/>
          </settings>
        </profile>
        <profile name="external">
          <domains>
            <domain name="all" alias="false" parse="false"/>
          </domains>
          <settings>
            <param name="context" value="default"/>
            <param name="sip-port" value="5080"/>
            <param name="dialplan" value="XML"/>
            <param name="rtp-ip" value="$${local_ip_v4}"/>
            <param name="sip-ip" value="$${local_ip_v4}"/>
            <param name="auth-calls" value="false"/>
          </settings>
          <gateways>
            <!--gateway name="sipnet">
          <param name="proxy" value="$${sipnet_proxy}"/>
          <param name="username" value="$${sipnet_login}"/>
          <param name="password" value="$${sipnet_password}"/>
        </gateway>-->
          </gateways>
        </profile>
      </profiles>
    </configuration>

    <configuration name="voicemail.conf">
      <profiles>
        <profile name="default"></profile>
      </profiles>
    </configuration>
  </section>

  <section name="dialplan">
    <context name="default">
      <extension name="local-accounts">
        <condition field="destination_number" expression="^(9821....)$">
          <action application="set" data="esl_manage=true"/>
          <!--action application="info"/-->
          <!--action application="answer"/-->
          <action application="park"/>
          <!--action application="bridge" data="user/$1@${domain_name}"/-->
          <!--action application="bridge" data="sofia/external/$1@192.168.1.3:40000"/-->
        </condition>
      </extension>
      
    </context>
  </section>

  <section name="directory">
    <domain name="$${local_ip_v4}">
      <params>
        <!--param name="dial-string" value="{presence_id=${dialed_user}@${dialed_domain}}${sofia_contact(*/${dialed_user}@${dialed_domain})}"/-->
        <param name="dial-string" value="sofia/external/${dialed_user}@$${test_provier_ip}:$${test_provier_port}"/>
      </params>
      <groups>
        <group name="local">
          <users>
            <user id="98212009">
              <params>
                <param name="password" value="98212009"/>
              </params>
            </user>
            <user id="98212010">
              <params>
                <param name="password" value="98212010"/>
              </params>
            </user>
            <user id="98212011">
              <params>
                <param name="password" value="98212011"/>
              </params>
            </user>
            <user id="sipp">
              <params>
                <param name="password" value="sipp"/>
              </params>
            </user>
          </users>
        </group>
      </groups>
    </domain>
  </section>

</document>